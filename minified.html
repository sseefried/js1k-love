<!doctype html>
<html>
  <head>
    <title>Alef you - @seanseefried</title>
    <meta charset="utf-8" />
  </head>
  <body>
    <canvas id="c"></canvas>
    <script>
      var b = document.body;
      var c = document.getElementsByTagName('canvas')[0];
      var a = c.getContext('2d');
      document.body.clientWidth; // fix bug in webkit: http://qfox.nl/weblog/218
    </script>
<!--start--><script>
    W=(w=c.width=400)/2;
    H=(h=c.height=360)/2;
    M=Math;
    var F;
    J=10;

    // Angle corrections. Not really necessary.
    // if(x<0&&y>0)p=M.PI-p;\
    // if(x<0&&y<0)p=p+M.PI;\
    // if(x>0&&y<0)p=-p;\


    eval("@t(w,f){\
            #@(x,y){\
               #f(m(x,w*2)-w,m(y,w*2)-w);}\
            }\
\
    @m(x,m){#(x%m+m)%m}\
\
    @q(f){\
      #@(x,y){\
        S=(y>0?1:-1);\
        X=x*x;Y=y*y;\
        d=X+Y-S*M.pow(X*Y*y*S,1/3);\
        e=1/(1-M.pow(d,.01));\
        p=M.atan(M.abs(y/x));\
        #(d<1)?f(e*M.cos(p),e*M.sin(p)):F\
      }\
    }\
\
    @s(s,f){\
      #@(x,y){\
        #f(x*s,y*s)\
      }\
    }\
\
    @P(i,j,f){\
      #@(x,y){\
        #f(x+i,y+j)\
      }\
    }".replace(/@/g,"function ").replace(/#/g,"return "));
    O=1;
    Z=1;
    n=o=0;
    B=3;
    onkeydown=function(e){
      z=e.keyCode;

      K=J*Z;
      // I completely got rid of all "if"s here and just used ternary operators
      z==190?
        (O&&A<=B?(g.push(f),f=t(h/36,s(16,f)),O=!O):A<B?(g.push(f),A++,f=s(3/h,q(f)),O=!O):F):
      z==188?
        (O&&A>=0?(A--,f=g.pop(),O=F):!O&&A>=-1?(f=g.pop(),O=1):F):
      // key codes I want to look at are 37-40,188,190

      z==37?n+=K:
      z==38?o-=K:
      z==39?n-=K:
      z==40?o+=K:
      z==189||z==109?Z*=1.1:
      z==187||z==61?Z*=.9:F;

      R(s(Z,P(n,o,f)))
    };

    A=-1;
//    function D(f){return M.round(f*k)/k;}// round to 2 decimal places

    function R(f){
      var i=0;
      I=a.createImageData(w,h);
      v=I.data;
      for (j=0;j<h-40;j++)
        for(x=-W;x<W;x++,i+=4)
          f(x,H-j)?(v[i]=H,v[i+3]=255):F;
     a.putImageData(I,0,0);

     a.font="21pt a";
     a.fillText("+-←↑↓→<>     I♥U"+(A>=0?" ℵ"+A:"")+
                                (O?"":"╳∞"),0,h-10);


//     a.fillText("("+D(n)+","+D(o)+")"+D(Z),0,h+20);
//     a.fillText(,w/2-20,h+30);
     // if(!O||A>=0){
     //     a.font=V;a.fillText("(zoom/pan to see)",w/2-20,h+50);
     //   }
     }
   g=[];
   f=s(3/h,q(t));//putting 't' here is the biggest hack! A function value is a truth value!
   R(f);
    </script>
  </body>
</html>

